---
import { getCollection } from "astro:content";
import Container from "@components/Container.astro";
import PageLayout from "@layouts/PageLayout.astro";
import SearchCollection from "@components/SearchCollection";
import { PROJECTS } from "@consts";

const allProjects = await getCollection("projects");
const projects = allProjects
    .filter((project) => !project.data.draft)
    .sort((a, b) => b.data.date.getTime() - a.data.date.getTime());

const tags = [...new Set(projects.flatMap((project) => project.data.tags))].sort((a, b) => a.localeCompare(b));

const estimated_initial_size = 28 + projects.length * 158 + (projects.length - 1) * 12;

const projectLink = (slug: string) => `/projects/${slug}`;

const blockchainProjects = [
    {
        id: "nft-rental-marketplace",
        title: "NFT Rental Marketplace",
        tagline: "Time-based NFT rentals with royalty support",
        stack: "Solidity · Hardhat · TypeScript · Ethers.js · Next.js",
        bullets: [
            "Smart contracts allow NFTs to be rented for fixed periods with automatic return.",
            "Royalty support for creators and safety checks against double-renting.",
            "Frontend for minting, listing, and renting NFTs.",
        ],
        links: [{ label: "GitHub", href: "https://github.com/imranpollob" }],
    },
    {
        id: "dao-grants-governance",
        title: "DAO – Community Grants Governance",
        tagline: "On-chain governance for community grants",
        stack: "Solidity · Hardhat · TypeScript · React",
        bullets: [
            "Token-based voting with proposal submission and quorum rules.",
            "Separation of proposal, voting, and treasury logic.",
            "Designed to be transparent and auditable.",
        ],
        links: [{ label: "GitHub", href: "https://github.com/imranpollob" }],
    },
    {
        id: "stablecoin-protocol",
        title: "Stablecoin Protocol",
        tagline: "Over-collateralized stablecoin experiment",
        stack: "Solidity · Foundry",
        bullets: [
            "Implements mint/burn flows with collateral ratios.",
            "Basic liquidation mechanism for under-collateralized positions.",
            "Focuses on safe arithmetic and security-aware design.",
        ],
        links: [{ label: "GitHub", href: "https://github.com/imranpollob" }],
    },
    {
        id: "solidity-ast-generator",
        title: "Solidity AST Generator",
        tagline: "Static analysis tooling for Solidity",
        stack: "JavaScript · Node.js",
        bullets: [
            "Parses Solidity contracts and emits ASTs.",
            "Used as a foundation for graph/hypergraph-based analysis.",
            "Demo highlights traversal and visualization paths.",
        ],
        links: [
            { label: "Project page", href: projectLink("03-solidity-ast-generator") },
            { label: "Demo", href: "https://ast.imranpollob.com/" },
            { label: "GitHub", href: "https://github.com/imranpollob/ast-generator" },
        ],
    },
];

const aiProjects = [
    {
        id: "multi-pdf-rag-chatbot",
        title: "Multi-PDF RAG Chatbot",
        stack: "Python · Vector store · LLM API",
        bullets: [
            "Lets users upload multiple PDFs and ask questions across all documents.",
            "Implements chunking, embedding, similarity search, and answer generation.",
            "Focus on prompt design and grounding answers in source text.",
        ],
        links: [{ label: "GitHub", href: "https://github.com/imranpollob" }],
    },
    {
        id: "ai-trading-suite",
        title: "AI Trading / Deal Finder / Bitcoin Price Prediction Suite",
        stack: "Python · ML libraries · APIs",
        bullets: [
            "Experiments with models for price prediction and opportunity detection.",
            "Includes data preprocessing, feature engineering, and backtesting.",
            "Demonstrates work with time-series data and evaluation metrics.",
        ],
        links: [{ label: "GitHub", href: "https://github.com/imranpollob" }],
    },
    {
        id: "food-detector-ai",
        title: "Food Detector AI",
        stack: "Python · CNN / computer vision",
        bullets: [
            "Classifies images of food into categories.",
            "End-to-end CV pipeline: dataset handling, training, evaluation, inference.",
            "Built to test model deployment patterns for lightweight CV apps.",
        ],
        links: [{ label: "GitHub", href: "https://github.com/imranpollob" }],
    },
];

const utilityProjects = [
    {
        name: "Pomodoro Timer App",
        description: "Desktop timer that stays on top of other windows to support deep work.",
        href: projectLink("02-pomodoro-timer-app"),
    },
    {
        name: "Task Time Tracker",
        description: "Tracks time spent on tasks with summaries.",
        href: projectLink("32-task-time-tracker"),
    },
    {
        name: "Snippet App",
        description: "Capture and search code snippets efficiently.",
        href: projectLink("04-snippet-app"),
    },
    {
        name: "Bangla Quran",
        description: "Web app with Arabic & Bangla translation and audio.",
        href: projectLink("08-bangla-quran"),
    },
];
---

<PageLayout title={PROJECTS.TITLE} description={PROJECTS.DESCRIPTION}>
    <section class="pt-28 pb-12">
        <Container size="xl">
            <div class="animate space-y-4 text-center">
                <div class="text-xl md:text-2xl lg:text-3xl page-heading">{PROJECTS.TITLE}</div>
                <p class="text-base md:text-lg text-black/80 dark:text-white/80">
                    I like to learn by building. These projects represent my work in blockchain, AI/ML, and developer
                    productivity. Many more are available on my GitHub.
                </p>
            </div>
        </Container>
    </section>

    <section class="pb-16" id="blockchain-projects">
        <Container size="xl">
            <div class="animate space-y-6">
                <div>
                    <p class="text-sm uppercase tracking-wide">Blockchain & Web3 Projects</p>
                    <h2 class="text-2xl font-bold text-black dark:text-white">On-chain builds</h2>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    {
                        blockchainProjects.map((project) => (
                            <div
                                id={project.id}
                                class="p-6 rounded-2xl border border-black/10 dark:border-white/15 glass-panel space-y-3"
                            >
                                <div class="flex items-start justify-between gap-3">
                                    <div>
                                        <p class="text-xs uppercase text-black/60 dark:text-white/60">
                                            {project.tagline}
                                        </p>
                                        <h3 class="text-xl font-semibold text-black dark:text-white">
                                            {project.title}
                                        </h3>
                                    </div>
                                    <span class="text-xs px-2 py-1 rounded-full border border-black/10 dark:border-white/20">
                                        {project.stack}
                                    </span>
                                </div>
                                <ul class="list-disc ml-5 space-y-2 text-sm md:text-base text-black/80 dark:text-white/80">
                                    {project.bullets.map((bullet) => (
                                        <li>{bullet}</li>
                                    ))}
                                </ul>
                                <div class="flex flex-wrap gap-2">
                                    {project.links.map((link) => (
                                        <a
                                            href={link.href}
                                            target={link.href.startsWith("http") ? "_blank" : undefined}
                                            class="px-3 py-1 rounded-full border border-black/10 dark:border-white/25 text-sm hover:bg-black/5 hover:dark:bg-white/15 transition"
                                        >
                                            {link.label}
                                        </a>
                                    ))}
                                </div>
                            </div>
                        ))
                    }
                </div>
            </div>
        </Container>
    </section>

    <section class="pb-16" id="ai-projects">
        <Container size="xl">
            <div class="animate space-y-6">
                <div>
                    <p class="text-sm uppercase tracking-wide">AI & ML Projects</p>
                    <h2 class="text-2xl font-bold text-black dark:text-white">Applied intelligence</h2>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    {
                        aiProjects.map((project) => (
                            <div
                                id={project.id}
                                class="p-6 rounded-2xl border border-black/10 dark:border-white/15 glass-panel space-y-3"
                            >
                                <div class="flex items-start justify-between gap-3">
                                    <h3 class="text-xl font-semibold text-black dark:text-white">{project.title}</h3>
                                    <span class="text-xs px-2 py-1 rounded-full border border-black/10 dark:border-white/20">
                                        {project.stack}
                                    </span>
                                </div>
                                <ul class="list-disc ml-5 space-y-2 text-sm md:text-base text-black/80 dark:text-white/80">
                                    {project.bullets.map((bullet) => (
                                        <li>{bullet}</li>
                                    ))}
                                </ul>
                                <div class="flex flex-wrap gap-2">
                                    {project.links.map((link) => (
                                        <a
                                            href={link.href}
                                            target={link.href.startsWith("http") ? "_blank" : undefined}
                                            class="px-3 py-1 rounded-full border border-black/10 dark:border-white/25 text-sm hover:bg-black/5 hover:dark:bg-white/15 transition"
                                        >
                                            {link.label}
                                        </a>
                                    ))}
                                </div>
                            </div>
                        ))
                    }
                </div>
            </div>
        </Container>
    </section>

    <section class="pb-16" id="utility-projects">
        <Container size="xl">
            <div class="animate space-y-6">
                <div>
                    <p class="text-sm uppercase tracking-wide">Productivity & Utility Projects</p>
                    <h2 class="text-2xl font-bold text-black dark:text-white">Small tools that ship</h2>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    {
                        utilityProjects.map((project) => (
                            <a
                                href={project.href}
                                class="p-4 rounded-2xl border border-black/10 dark:border-white/15 glass-panel hover:-translate-y-0.5 transition-transform"
                            >
                                <h3 class="text-lg font-semibold text-black dark:text-white">{project.name}</h3>
                                <p class="text-sm md:text-base text-black/80 dark:text-white/80 mt-1">
                                    {project.description}
                                </p>
                                <p class="mt-3 text-sm font-semibold underline decoration-[.5px] underline-offset-4">
                                    View project →
                                </p>
                            </a>
                        ))
                    }
                </div>
            </div>
        </Container>
    </section>

    <section class="pb-20">
        <Container size="xl">
            <div class="animate space-y-4">
                <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3">
                    <div>
                        <p class="text-sm uppercase tracking-wide">Project Archive</p>
                        <h2 class="text-2xl font-bold text-black dark:text-white">Browse everything</h2>
                    </div>
                </div>
                <div id="search-collection-wrapper" style={{ minHeight: `${estimated_initial_size}px` }}>
                    <SearchCollection client:load entry_name={"projects"} tags={tags} data={projects} />
                </div>
            </div>
        </Container>
    </section>
</PageLayout>
